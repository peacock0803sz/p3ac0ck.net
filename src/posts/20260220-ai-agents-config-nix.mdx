---
slug: 20260220-ai-agents-config-nix
title: Nixã§AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¨­å®šã‚’å®£è¨€çš„ã«ç®¡ç†ã™ã‚‹ãŸã‚ã«
lang: ja
emoji: "ğŸ¤–"
pubDate: 2026-02-20
---

Nixã‚’ç”¨ã„ã¦AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¨­å®šã‚’ç®¡ç†ã™ã‚‹å€‹äººçš„ãƒã‚¦ãƒã‚¦ãŒè“„ç©ã•ã‚Œã¦ããŸã®ã§ã€åŸ·ç­†æ™‚ç‚¹(2026-02-20)ã®è¨­è¨ˆæ€æƒ³ãªã©ã‚’ã¾ã¨ã‚ã¦ãŠãã€‚

# æƒ³å®šèª­è€…

- Nix (Home Manager)ã‚’åˆ©ç”¨ã—ã¦dotfilesãªã©ã§å„ç¨®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†ã—ã¦ã„ã‚‹
- AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ(Claude Code, Codex CLIç­‰)ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚‚Nixã§ç®¡ç†ã—ãŸã„
    - ç®¡ç†ã—ã¦ã„ã‚‹ãŒä»–äººã®è¨­å®šæ€æƒ³ãŒæ°—ã«ãªã‚‹

# å‰æçŸ¥è­˜

- [Nix](https://nixos.org/) / [Home Manager](https://github.com/nix-community/home-manager) ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹
- [Claude Code](https://docs.anthropic.com/en/docs/claude-code) ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

# æ§‹æˆ

## åˆ©ç”¨ã—ã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤

- [numtide/llm-agents.nix](https://github.com/numtide/llm-agents.nix): æ—¥ã€…æ›´æ–°ã•ã‚Œã‚‹Claude Code, Codex CLI, Gemini CLIç­‰ã®æœ€æ–°ç‰ˆãƒªãƒªãƒ¼ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚
- [natsukium/mcp-servers-nix](https://github.com/natsukium/mcp-servers-nix): MCP Serverã‚’å®£è¨€çš„ã«è¨­å®šã™ã‚‹ãŸã‚
- [Kyure-A/agent-skills-nix](https://github.com/Kyure-A/agent-skills-nix): å¤–éƒ¨ã¨ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†ã®Skillã‚’åŒ…æ‹¬çš„ã«ç®¡ç†ã™ã‚‹ãŸã‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ (æŠœç²‹)

```
$HOME/dotfiles
â”œâ”€â”€ flake.lock
â”œâ”€â”€ flake.nix                                # ãƒ«ãƒ¼ãƒˆflake
â”œâ”€â”€ .config
â”‚   â”œâ”€â”€ agents
â”‚   â”‚   â”œâ”€â”€ AGENTS.md                        # å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…±æœ‰ãƒ¡ãƒ¢ãƒª (CLAUDE.md)
â”‚   â”‚   â”œâ”€â”€ LICENSE.md
â”‚   â”‚   â”œâ”€â”€ local-skills                     # è‡ªä½œã‚¹ã‚­ãƒ«é…ç½®å ´æ‰€
â”‚   â”‚   â”‚   â”œâ”€â”€ commit
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SKILL.md
â”‚   â”‚   â”‚   â”œâ”€â”€ maintain-agent
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SKILL.md
â”‚   â”‚   â””â”€â”€ rules                            # Claude Codeç”¨ãƒ«ãƒ¼ãƒ«
â”‚   â”‚       â””â”€â”€ documentation.md
â”‚   â”œâ”€â”€ nix
â”‚   â”‚   â”œâ”€â”€ home-manager
â”‚   â”‚   â”‚   â”œâ”€â”€ platforms
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ darwin.nix
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ nixos.nix
â”‚   â”‚   â”‚   â”œâ”€â”€ presets
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ large.nix                # claude-code, codex, gemini ã‚’å«ã‚€ãƒ—ãƒªã‚»ãƒƒãƒˆ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ tiny.nix / tiny.nix ...  # ä»–ãƒ—ãƒªã‚»ãƒƒãƒˆå®šç¾©
â”‚   â”‚   â”‚   â””â”€â”€ programs
â”‚   â”‚   â”‚       â”œâ”€â”€ agent-skill              # ã‚¹ã‚­ãƒ«ç®¡ç†sub-flake
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ flake.lock
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ flake.nix
â”‚   â”‚   â”‚       â”œâ”€â”€ claude-code.nix          # Claude Codeè¨­å®š
â”‚   â”‚   â”‚       â”œâ”€â”€ codex.nix                # Codex CLIè¨­å®š
â”‚   â”‚   â”‚       â”œâ”€â”€ gemini.nix               # Gemini CLIè¨­å®š
â”‚   â”‚   â”‚       â”œâ”€â”€ mcp-servers
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ default.nix          # MCP Serverè©•ä¾¡ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ programs.nix         # å…±æœ‰MCP Serverå®šç¾©
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ esa                  # ãƒ›ã‚¹ãƒˆå›ºæœ‰MCP Server
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ default.nix
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ wrike
â”‚   â”‚   â”‚       â”‚       â””â”€â”€ default.nix
â”‚   â”‚   â”‚       â”œâ”€â”€ ...
â”‚   â”‚   â”‚       â””â”€â”€ neovim.nix
â”‚   â”‚   â”œâ”€â”€ hosts
â”‚   â”‚   â”‚   â”œâ”€â”€ arpeggio                     # ç¤¾ç”¨ãƒã‚·ãƒ³å®šç¾© (aarch64-darwin)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ default.nix
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ home.nix
â”‚   â”‚   â”‚   â””â”€â”€ enigma/                      # ä»–ãƒ›ã‚¹ãƒˆã®å®šç¾©
â”‚   â”‚   â””â”€â”€ nix-darwin
â”‚   â”‚       â””â”€â”€ default.nix
â””â”€ README.md
```

## [claude-code.nix](https://github.com/peacock0803sz/dotfiles/blob/f68763eb18af2daec12a4c5b022aa9efe8d00593/.config/nix/home-manager/programs/claude-code.nix): Claude Codeè¨­å®š

`programs.claude-code` Home Managerãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§Claude Codeã®å…¨è¨­å®šã‚’Nixã§è¨˜è¿°ã—ã€llm-agents.nixã‚’åˆ©ç”¨ã—ã¦æœ€æ–°ç‰ˆã®Claude Codeã‚’å¸¸ã«å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«æ§‹æˆã€‚

```nix
{ pkgs, config, hostName, mcp-servers-nix, ... }:
let
  mkOutOfStoreSymlink = config.lib.file.mkOutOfStoreSymlink;
  homeDirectory = config.home.homeDirectory;
  enableCodex = true;
  mcp-servers = import ./mcp-servers { inherit pkgs mcp-servers-nix enableCodex; };
in
{
  home.packages = with pkgs; [
    llm-agents.ccusage
    llm-agents.claude-code-acp
  ];

  home.file = {
    ".claude/rules".source = mkOutOfStoreSymlink
      "${homeDirectory}/dotfiles/.config/agents/rules";
  };

  programs.claude-code = {
    enable = true;
    package = pkgs.llm-agents.claude-code;
    memory.source = ../../../agents/AGENTS.md;

    settings = {
      theme = "light";
      autoUpdates = false;
      includeCoAuthoredBy = false;
      autoCompactEnabled = false;
      enableAllProjectMcpServers = true;
      outputStyle = "Explanatory";
      statusLine = {
        type = "command";
        command = "echo $(cat) | ccusage statusline";
      };

      permissions = {
        deny = [
          "Bash(rm -rf /*)"
          "Bash(rm -rf /)"
          "Bash(sudo *)"
          # ... ä»–ã®å±é™ºãªã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³
        ];
      };

      enabledPlugins = {
        "gopls-lsp@claude-plugins-official" = true;
        "lua-lsp@claude-plugins-official" = true;
        "pyright-lsp@claude-plugins-official" = true;
        "typescript-lsp@claude-plugins-official" = true;
        "atlassian@claude-plugins-official" =
          if hostName == "arpeggio" then true else false;
        "pr-review-toolkit@claude-plugins-official" = true;
        "feature-dev@claude-plugins-official" = true;
      };
    };

    mcpServers = mcp-servers // (if hostName == "arpeggio" then {
      esa = (import ./mcp-servers/esa { inherit pkgs; });
      wrike = (import ./mcp-servers/wrike { inherit pkgs; });
    } else { });
  };
}
```

### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

#### å¯å¤‰ã¨ä¸å¤‰ã®å¢ƒç•Œ

è¨­å®šã®æ€§è³ªã«å¿œã˜ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®æ–¹æ³•ã‚’2ã¤ã«åˆ†ã‘ã¦ã„ã‚‹ã€‚

| ãƒ•ã‚¡ã‚¤ãƒ« | é…ç½®æ–¹æ³• | æ›´æ–°æ–¹æ³• |
|---|---|---|
| `AGENTS.md` | Nix Storeã«ã‚³ãƒ”ãƒ¼ | `nix run nix-darwin -- switch` |
| `rules/` | Out-of-Store Symlink | ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ã®ã¿ã€ãƒªãƒ“ãƒ«ãƒ‰ä¸è¦ |

`AGENTS.md` ã¯ `memory.source` ã§Nix Storeã«å–ã‚Šè¾¼ã¾ã‚Œã€ãƒªãƒ“ãƒ«ãƒ‰æ™‚ã« `~/.claude/CLAUDE.md` ã¸åæ˜ ã•ã‚Œã‚‹ã€‚å¤‰æ›´é »åº¦ãŒä½ãã€ç¢ºå®šã—ãŸå†…å®¹ã‚’ç¢ºå®Ÿã«åæ˜ ã—ãŸã„ã‚‚ã®ã«å‘ã„ã¦ã„ã‚‹ã€‚

`rules/` ã¯ `mkOutOfStoreSymlink` ã§å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’å¼µã‚‹ã€‚Nix Storeã‚’çµŒç”±ã—ãªã„ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚Œã°ãã®ã¾ã¾Claude Codeã«åæ˜ ã•ã‚Œã‚‹ã€‚ãƒ«ãƒ¼ãƒ«ã‚’è©¦è¡ŒéŒ¯èª¤ã—ãªãŒã‚‰èª¿æ•´ã™ã‚‹ã®ã«éƒ½åˆãŒã„ã„ã€‚

#### ãƒ›ã‚¹ãƒˆæ¡ä»¶åˆ†å²

`hostName` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã€åŒã˜Nixã‚³ãƒ¼ãƒ‰ã‹ã‚‰ç•°ãªã‚‹ãƒ›ã‚¹ãƒˆå‘ã‘ã®è¨­å®šã‚’ç”Ÿæˆã§ãã‚‹ã€‚æ¥­å‹™ãƒã‚·ãƒ³ã§ã ã‘Atlassianãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚„esa/wrike MCPã‚µãƒ¼ãƒãƒ¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€ã¨ã„ã£ãŸåˆ‡ã‚Šæ›¿ãˆãŒ1ç®‡æ‰€ã§æ¸ˆã‚€ã€‚

```nix
# ãƒ›ã‚¹ãƒˆå›ºæœ‰ã®è¨­å®šã¯ hostName ã§åˆ†å²
"atlassian@claude-plugins-official" = if hostName == "arpeggio" then true else false;
```

`hostName` ã¯ãƒ›ã‚¹ãƒˆå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã§è¨­å®šã—ã€`home-manager.extraSpecialArgs` çµŒç”±ã§å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«æ¸¡ã‚‹ã€‚

```nix
# .config/nix/hosts/nocturne/default.nix (æŠœç²‹)
home-manager.extraSpecialArgs = { inherit hostName mcp-servers-nix; };
home-manager.users.${username} = {
  imports = [
    ../../home-manager/presets/huge.nix
    inputs.agent-skills.homeManagerModules.upstream
    inputs.agent-skills.homeManagerModules.config
  ];
};
```

## [mcp-servers/programs.nix](https://github.com/peacock0803sz/dotfiles/blob/f68763eb18af2daec12a4c5b022aa9efe8d00593/.config/nix/home-manager/programs/mcp-servers/programs.nix): MCP Serverå®šç¾©ã®å…±æœ‰

Claude Code, Codex CLI, Gemini CLIã®3ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§åŒã˜MCP Serverã‚»ãƒƒãƒˆã‚’ä½¿ãˆã‚‹ã‚ˆã†ã€å®šç¾©ã‚’1ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¦ã„ã‚‹ã€‚

```nix
{ pkgs, enableCodex, ... }: {
  codex.enable = enableCodex;
  serena = {
    enable = true;
    args = [ "--context" "ide-assistant" "--enable-web-dashboard" "False" ];
  };
  context7.enable = true;
  playwright = {
    enable = true;
    executable =
      if pkgs.stdenv.isDarwin
      then "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome"
      else "${pkgs.chromium}/bin/chromium";
  };
  github = {
    enable = true;
    passwordCommand = "echo \"GITHUB_PERSONAL_ACCESS_TOKEN=$(gh auth token)\"";
  };
  terraform.enable = true;
  nixos.enable = true;
  time = {
    enable = true;
    args = [ "--local-timezone=Asia/Tokyo" ];
  };
}
```

`mcp-servers-nix` ã®å®£è¨€çš„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚ˆã‚Šã€å„MCP Serverã®æœ‰åŠ¹ç„¡åŠ¹ã‚„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’Nixã®å±æ€§ã‚»ãƒƒãƒˆã§æ›¸ã‘ã‚‹ã€‚`enable = true` ã¨ã™ã‚‹ã ã‘ã§ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å–å¾—ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ã®è§£æ±ºã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆã¾ã§è‡ªå‹•ã§è¡Œã‚ã‚Œã‚‹ã€‚

### å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã®åˆ©ç”¨

ã“ã® `programs.nix` ã‚’ã€å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚

```nix
# claude-code.nix ã§ã®åˆ©ç”¨
mcp-servers = import ./mcp-servers { inherit pkgs mcp-servers-nix enableCodex; };
```

```nix
# codex.nix ã§ã®åˆ©ç”¨ -- TOMLå½¢å¼ã§å‡ºåŠ›
config = mcp-servers-nix.lib.mkConfig pkgs {
  flavor = "codex";
  format = "toml-inline";
  fileName = ".mcp.toml";
  programs = import ./mcp-servers/programs.nix { inherit pkgs mcp-servers-nix enableCodex; };
};
```

```nix
# gemini.nix ã§ã®åˆ©ç”¨ -- settingså†…ã«ç›´æ¥åŸ‹ã‚è¾¼ã¿
mcpServers = import ./mcp-servers { inherit pkgs mcp-servers-nix enableCodex; };
```

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã§ç•°ãªã‚‹ã®ã¯ `enableCodex` ãƒ•ãƒ©ã‚°ã ã‘ã€‚Claude Codeã¯Codex CLIã‚’MCP ServerçµŒç”±ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã—ã¦ä½¿ã†ãŸã‚ `enableCodex = true` ã«ã™ã‚‹ã€‚  
ä¸€æ–¹ã€Codex CLIè‡ªèº«ã®è¨­å®šã§è‡ªåˆ†ã‚’å‘¼ã¶ã¨å†å¸°ã«ãªã‚‹ã®ã§ `enableCodex = false` ã¨ã™ã‚‹ã€‚Gemini CLIã‚‚åŒæ§˜ã€‚

| ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | `enableCodex` | å‡ºåŠ›å½¢å¼ |
|---|---|---|
| Claude Code | `true` | JSON |
| Codex CLI | `false` | TOML |
| Gemini CLI | `false` | JSON |

### AGENTS.md ã®å…±æœ‰

3ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå…¨ã¦ãŒåŒä¸€ã® `AGENTS.md` ã‚’ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ã—ã¦èª­ã¿è¾¼ã‚€ã€‚

```nix
# claude-code.nix
memory.source = ../../../agents/AGENTS.md;

# codex.nix -- symlinkJoinã®ãƒ¡ã‚¿å±æ€§ã¨ã—ã¦
custom-instructions = builtins.readFile ../../../agents/AGENTS.md;

# gemini.nix
context = { GEMINI = "../../../agents/AGENTS.md"; };
```

ã“ã‚Œã§æ“ä½œåˆ¶é™ã‚„ã‚¹ã‚­ãƒ«ä¸€è¦§ã¨ã„ã£ãŸåŸºæœ¬ãƒ«ãƒ¼ãƒ«ãŒã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å•ã‚ãšåŒã˜å†…å®¹ã«ãªã‚‹ã€‚

## [agent-skills/flake.nix](https://github.com/peacock0803sz/dotfiles/blob/f68763eb18af2daec12a4c5b022aa9efe8d00593/.config/nix/home-manager/programs/agent-skills/flake.nix): Agent Skills ã®å®£è¨€çš„ç®¡ç†

```nix
{
  description = "Agent Skills Nix Configuration";

  inputs = {
    agent-skills-nix.url = "github:Kyure-A/agent-skills-nix";
    anthropic = {
      url = "github:anthropics/skills";
      flake = false;  # flakeã§ã¯ãªã„ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚½ãƒ¼ã‚¹ã¨ã—ã¦å–å¾—
    };
    vercel = {
      url = "github:vercel-labs/agent-skills";
      flake = false;
    };
  };

  outputs = { agent-skills-nix, ... }@inputs: {
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æœ¬ä½“ã‚’ãã®ã¾ã¾re-export
    homeManagerModules.upstream = agent-skills-nix.homeManagerModules.default;

    # è¨­å®šã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦æä¾›
    homeManagerModules.config = { config, lib, hostName, ... }: {
      programs.agent-skills = {
        enable = true;

        # ã‚¹ã‚­ãƒ«ã‚½ãƒ¼ã‚¹ã®å®šç¾©
        sources = {
          anthropic = {
            path = inputs.anthropic.outPath;
            subdir = "skills";
          };
          vercel-labs = {
            path = inputs.vercel.outPath;
            subdir = "skills";
          };
          local = {
            path = "${config.home.homeDirectory}/dotfiles/.config/agents/local-skills";
          };
        } // lib.optionalAttrs (hostName == "arpeggio") {
          gx-agent-recipes = {  # ç¤¾å†…ã§å…±æœ‰ãƒ»ç®¡ç†ã—ã¦ã„ã‚‹ã‚¹ã‚­ãƒ«ç¾¤
            path = "${config.home.homeDirectory}/ghq/github.com/groove-x/gx-agent-recipes";
            subdir = "skills";
          };
        };

        # ã‚½ãƒ¼ã‚¹å†…ã®å…¨ã‚¹ã‚­ãƒ«ã‚’æœ‰åŠ¹åŒ–
        skills.enableAll = [ "local" ] ++ lib.optional (hostName == "arpeggio") "gx-agent-recipes";

        # å€‹åˆ¥ã‚¹ã‚­ãƒ«ã®é¸æŠçš„æœ‰åŠ¹åŒ–
        skills.enable = [
          "frontend-design"
          "skill-creator"
          "webapp-testing"
          "composition-patterns"
          "react-best-practices"
          "web-design-guidelines"
        ];

        # ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®å®šç¾©
        targets = {
          claude = { dest = ".claude/skills"; structure = "link"; };
          codex  = { dest = ".codex/skills";  structure = "link"; };
        };
      };
    };
  };
}
```

Agent Skillsã¯ã€Claude Codeã‚„Codex CLIã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã‚’æ‹¡å¼µã™ã‚‹ä»•çµ„ã¿ã€‚ã“ã®ç®¡ç†ã‚’ç‹¬ç«‹ã—ãŸsub-flakeã«åˆ‡ã‚Šå‡ºã—ã¦ã„ã‚‹ã€‚

### ãªãœsub-flakeã«ã—ã¦ã„ã‚‹ã®ã‹

ã‚¹ã‚­ãƒ«ã®ã‚½ãƒ¼ã‚¹ã¯Anthropicã‚„Vercel Labsã®å¤–éƒ¨GitHubãƒªãƒã‚¸ãƒˆãƒªã«ä¾å­˜ã—ã¦ãŠã‚Šã€ã“ã‚Œã‚‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒ¡ã‚¤ãƒ³ã® `flake.lock` ã¨ã¯åˆ¥ã«ãƒ”ãƒ³ç•™ã‚ã—ãŸã„ã®ã§ã€`agent-skills/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç‹¬è‡ªã®flakeã¨ã—ã¦åˆ†é›¢ã—ãŸã€‚

```
flake.nix (ãƒ«ãƒ¼ãƒˆ)
  â””â”€â”€ inputs.agent-skills.url = "path:./.config/nix/home-manager/programs/agent-skills"
        â””â”€â”€ agent-skills/flake.nix (sub-flake)
              â”œâ”€â”€ inputs.agent-skills-nix  -- Home Managerãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
              â”œâ”€â”€ inputs.anthropic         -- anthropics/skills ãƒªãƒã‚¸ãƒˆãƒª
              â””â”€â”€ inputs.vercel            -- vercel-labs/agent-skills ãƒªãƒã‚¸ãƒˆãƒª
```


### ã‚¹ã‚­ãƒ«ã‚½ãƒ¼ã‚¹ã®3ç¨®é¡

| ã‚½ãƒ¼ã‚¹ç¨®åˆ¥ | ä¾‹ | é…ç½®å…ˆ | æ›´æ–°æ–¹æ³• |
|---|---|---|---|
| å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒª | `anthropic`, `vercel-labs` | Nix Store | `nix flake update` |
| ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹ | `local` | å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ | ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ã®ã¿ |
| ãƒ›ã‚¹ãƒˆå›ºæœ‰ | `gx-agent-recipes` | å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ | ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ã®ã¿ |

å¤–éƒ¨ãƒªãƒã‚¸ãƒˆãƒªã¯ `flake = false` ã§å–å¾—ã—ã€`outPath` ã§Nix Storeä¸Šã®ãƒ‘ã‚¹ã‚’å‚ç…§ã™ã‚‹ã€‚ç‰¹å®šã‚³ãƒŸãƒƒãƒˆã¸ã®ãƒ”ãƒ³ç•™ã‚ã¯ `flake.lock` ãŒè‡ªå‹•ã§ç®¡ç†ã—ã¦ãã‚Œã‚‹ã€‚

ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚­ãƒ«ã¯ `config.home.homeDirectory` ã‚’ä½¿ã£ã¦å®Ÿãƒ‘ã‚¹ã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã€‚Nix Storeã‚’çµŒç”±ã—ãªã„ã®ã§ã€`rules/` ã¨åŒã˜ããƒªãƒ“ãƒ«ãƒ‰ãªã—ã§å†…å®¹ã‚’å¤‰æ›´ã§ãã‚‹ã€‚

### targets ã§ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤

`targets` ã§ã€æœ‰åŠ¹åŒ–ã—ãŸã‚¹ã‚­ãƒ«ã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã‚’è¤‡æ•°æŒ‡å®šã™ã‚‹ã€‚

```nix
targets = {
  claude = { dest = ".claude/skills"; structure = "link"; };
  codex  = { dest = ".codex/skills";  structure = "link"; };
};
```

`structure = "link"` ã«ã™ã‚‹ã¨ã€å„ã‚¹ã‚­ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ãŒ `~/.claude/skills/` ã¨ `~/.codex/skills/` ã®ä¸¡æ–¹ã«ä½œæˆã•ã‚Œã‚‹ã€‚ã‚¹ã‚­ãƒ«ã®è¿½åŠ ã‚„å‰Šé™¤ã¯Nixè¨­å®šã‚’å¤‰ãˆã¦ãƒªãƒ“ãƒ«ãƒ‰ã™ã‚Œã°åæ˜ ã•ã‚Œã‚‹ã€‚æ‰‹å‹•ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ã¯ãªã„ã€‚

### ãƒ›ã‚¹ãƒˆå®šç¾©ã§ã®çµ±åˆ

sub-flakeã®2ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€ãƒ›ã‚¹ãƒˆå®šç¾©ã® `imports` ã«è¿½åŠ ã™ã‚‹ã€‚

```nix
# .config/nix/hosts/nocturne/default.nix (æŠœç²‹)
home-manager.users.${username} = {
  imports = [
    ../../home-manager/presets/huge.nix
    inputs.agent-skills.homeManagerModules.upstream  # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©
    inputs.agent-skills.homeManagerModules.config    # è¨­å®š
  ];
};
```

`upstream` ãŒHome Managerãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æœ¬ä½“ã€`config` ãŒã‚¹ã‚­ãƒ«ã®é¸æŠã¨ã‚½ãƒ¼ã‚¹å®šç¾©ã‚’æ‹…å½“ã™ã‚‹ã€‚åˆ†é›¢ã—ã¦ãŠãã¨ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è‡ªä½“ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¨è¨­å®šå¤‰æ›´ã‚’ç‹¬ç«‹ã—ã¦è¡Œãˆã‚‹ã€‚

# ã¾ã¨ã‚

- è¤‡æ•°ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®è¨­å®šåŒæœŸ: å…±æœ‰ `programs.nix` ã¨ `AGENTS.md`
- MCP Serverã®è¿½åŠ ã¨å‰Šé™¤: `enable = true/false` ã®1è¡Œå¤‰æ›´
- ã‚¹ã‚­ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†: `flake.lock` ã«ã‚ˆã‚‹è‡ªå‹•ãƒ”ãƒ³ç•™ã‚
- ãƒ›ã‚¹ãƒˆé–“ã®è¨­å®šå·®ç•°: `hostName` ã«ã‚ˆã‚‹æ¡ä»¶åˆ†å²

ä¸Šè¨˜ã®ã‚ˆã†ãªèª²é¡Œã«å¯¾ã—ã¦ã€ãã‚Œã«å¯¾ã™ã‚‹Nixå´ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ç®¡ç†ã®ç…©é›‘ã•ã‚’çœåŠ›åŒ–ã—ã¦ã„ã‚‹ã€‚
